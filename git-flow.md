Teambition 工作流规范
---------------------------------

### 分支简述

![工作流示意图](./images/git-flow.jpg)

正常的工作流里面，我们会把分支分为 `release`，`develop` 和开发人员的提交分支。

`release` 分支的含义是相对稳定，发布在正式环境上面的代码。这个分支是一个短命分支，里面的更改和优化不会再回溯到 `develop` 分支中去。`bug` 的修复会发布一个小版本；而一个功能发布会重新定义 `release` 分支，以前的就舍弃掉了。

`develop` 分支的含义是一个相对不稳定，可能再开发的阶段的代码。这里面的代码一般情况下是下一个阶段会发布的代码，通常会跑在内测环境上面。


### 所有提交信息全部使用中文

团队成员里面大概不会有不认识中文的同学，全体使用中文的话，能够提高可读性。

如果本来英文就不好，然后写出了蹩脚的信息，再让另一个英文不好的同学去阅读，吼吼，INTERESTING。

关于使用英文的好处，我觉得除了提高 BIGGER 以外，大概没有什么好处了。


### 分支命名规则

- `feature/xxx-xxx` (命名一个功能分支)
- `issue/xxx-xxx` (命名一个 develop 线上的修复)
- `hotfix/xxx-xxx` (命名一个 release 线上的修复)

一般情况下，所有的 `feature` 分支都应该从 `develop` 分支切出来，并且目标分支也是 `develop` 分支。

`bug` 的修复需要寻找引入源，既有可能是新功能开发引入的，也有可能是以前的代码引入的，所以有以下三种情况：
- 修复到 `develop` 线
- 修复到 `release` 线
- 修复到 `release` 和 `develop` 线

#### 修复到 develop 线

这个 `bug` 是由 `develop` 上新的代码引入的bug。那么只需要从 develop 切一个 issue 分支，修复完成之后，合并的目标是 develop。

#### 修复到 release 线

如果一个 `bug` 是老代码引入，并且因为在新的 `develop` 功能开发或者优化中已经解决了，那么这里只需要从 `release` 线上切一个 `hotfix` 分支，修复完成之后，合并的目标是 `release。`

#### 修复到 release 和 develop 线

如果一个 `bug` 是老代码引入，并且在 `develop` 上面仍然有问题，那么这一次修复既要合并到 `release` 中，也要合并到 `develop` 中。从 `develop` 切一个 `hotfix` 分支，
合并的目标是 `develop` 。合并代码的同学看见一个目标是 `develop` 的 `hotfix` 分支，应该主动把代码 `cherry-pick` 到 `release` 上去。如果在 `cherry-pick` 的时候产生了冲突，那么应该让修复 `bug` 的同学重新提交一次。当然，主动让合并代码的同学去做 `cherry-pick` 的话其实非常不自然，以后希望能有自动话的工具解决这样的事情。

### rebase 到最新的目标线，并且合并成为一个提交

为了提高代码库的可维护性，所以会采取 `merge --squash` 的方式，所以要求提交的代码需要合并成为一个，并且写上合法的信息，经由审核的同学查看之后，合并到目标线上去。

为什么要采取 `merge --squash` 的方式？

因为在开发的过程中，分为三个阶段，非常不稳定的开发阶段，不稳定的内测阶段，基本稳定的发布阶段。

通常情况下，进入了内测阶段之后，代码会被合并到 `develop` 分支线上面来。这时侯，开发分支的任务基本结束，所以会被清除掉。一般情况下，进入内测阶段的功能都是下个版本需要发布的东西；但是，在快速迭代的过程中，很有可能出现内测功能不在下一个版本迭代中的情况产生。于是，这时候就需要对代码进行拆解，而拆解代码的依据除了源码以外，就是提交信息了。所以，我们希望每个提交的信息都是很完善，很可靠的。


### 提交信息模版

提交信息里面需要带一些机器消息，让电脑能够识别和处理。

`FEATURE` 功能短名，一个功能在开发开始的时候，就应该有一个固定不变的短名来标记这是什么。

`BUG` 修复短名，如果这次修复跟上面的功能紧密相关，那么

`TASK` 与分支对应的 Teambition 任务的 id

`R` 审核人的邮箱或者名字，比如：huaqiao, huaqiao@teambition.com

```
[DOC] 提交模板的标题

这是是描述的第一段信息，用举例说明提交一个合法的提交信息是怎么样的。

这是是描述的第二段信息，用来说明这次提交的一些东西。

FEATURE/BUG 模板
TASK 56cd5df09c8a6ba82e2bac0a
R huaqiao@teambition.com
```

### 一些题外的话

有时候我会觉得，这样写信息非常得浪费时间，不过呢，写下来总是好的，为以后可能发生的问题提供很多可靠的依据。
